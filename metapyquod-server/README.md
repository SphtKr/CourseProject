# `metapyquod-server` Canned prototype search microservice using MeTA/metapy

## Overview

This container implements a minimal but functional search service as a REST API, which can be used as a base for rapid prototyping of either a search portal web site or mobile app (or other client). It uses the MeTA toolkit and metapy bindings, so may be suitable for research or prototyping of new rankers or techniques via that library.

## Usage

### Prerequisites

You must have an index or corpus that can be used to build an index, with a `.toml` config file suitable for passing to `metapy.index.make_inverted_index(...)`. The index must include the following metadata fields:

```toml
metadata = [{name = "title", type = "string"},
    {name = "url", type = "string"},
    {name = "mtime", type = "uint"}]
```

Note: see [`metapyquod-indexer`](https://github.com/sphtkr/MeTAPyquod/metapyquod-indexer) which works together with [wget](https://www.gnu.org/software/wget/) to generate such an index.

### Running

Invoke the server providing the path to the index's `config.toml` file in the environment variable `METAPYQUOD_IDX_TOML`. The path should be the correct path *within the container*, so if a volume is used make sure those paths line up.

docker run -v `pwd`:/var/idx -e METAPYQUOD_IDX_TOML=/var/idx/sample/config.toml -p 8080:8080 sphtkr/metapyquod-server

Also, note that the paths *inside* the `config.toml` file must be correct in reflecting the location within the container, not on the host. So in the example above, the `config.toml` looks like this:

```
prefix = "/var/idx/sample"
stop-words = "/var/idx/sample/lemur-stopwords.txt"
dataset = "sample"
corpus = "line.toml"
index = "/var/idx/sample/idx"
metadata = [{name = "title", type = "string"},
    {name = "url", type = "string"},
    {name = "mtime", type = "uint"}]

[[analyzers]]
method = "ngram-word"
ngram = 1
filter = "default-unigram-chain"
```

## Implementation
This server was generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project. By using the
[OpenAPI-Spec](https://github.com/swagger-api/swagger-core/wiki) from a remote server, you can easily generate a server stub.  This
is an example of building a swagger-enabled Flask server.

This example uses the [Connexion](https://github.com/zalando/connexion) library on top of Flask.

